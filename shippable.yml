# Language setting
language: node_js

build_image: trriplejay/simpleserver:latest
# Version number
node_js:
  - 0.10

# The path for Xunit to output test reports
env:
  global:
    - DEBUG=mongodb*,Mockgoose
    - XUNIT_FILE=shippable/testresults/result.xml
build:
  ci:

    - echo "$USER"
    - echo "$HOME"
    - sudo docker ps -a
    - EXEC_ID=`sudo docker ps | grep shippable-exec | awk '{print $1}'`
    - sudo docker logs --tail=500 $EXEC_ID
    - sudo docker inspect $EXEC_ID
    - source ~/.nvm/nvm.sh
    - node --version
    - touch .npmrc
    - chmod 600 .npmrc
    - shippable_retry npm install --loglevel silent
    #- echo "starting the stress test"
    #- sudo apt-get install -y stress 
    #- stress -t 10 -m 20 --vm-hang 5
    #- echo "finished the stress test"
    - echo "made it past npm install"

# Create directories for test and coverage reports
#before_script:
#  - mkdir -p shippable/testresults
#  - mkdir -p shippable/codecoverage

# Running the tests with grunt
#script:
#  - grunt

# Tell istanbul to generate a coverage report
#after_script:
#  - ./node_modules/.bin/istanbul cover grunt -- -u tdd
#  - ./node_modules/.bin/istanbul report cobertura --dir  shippable/codecoverage/
