# Language setting
language: node_js


# Version number
node_js:
  - 0.10

# The path for Xunit to output test reports
env:
  global:
    - XUNIT_FILE=shippable/testresults/result.xml


# build_image: trriplejay/simpleserver:latest
#
# install:
#   - echo "$USER"
#   - echo "$HOME"
#   - sudo docker ps -a
#   - EXEC_ID=`sudo docker ps | grep shippable-exec | awk '{print $1}'`
#   - sudo docker logs --tail=500 $EXEC_ID
#   - sudo docker inspect $EXEC_ID
#   #- source ~/.nvm/nvm.sh && nvm install 0.12
#   - node --version
#   - sudo npm install -g grunt-cli
#   - sudo npm install
#   #- ./catFile.sh
#   #- cat Ulysses.txt 1>&2
#   - cat Ulysses.txt
#   - grunt
#
# after_script:
#   - ./node_modules/.bin/istanbul cover grunt -- -u tdd
#   - ./node_modules/.bin/istanbul report cobertura --dir  shippable/codecoverage/


build:
  pre_ci_boot:
    image_name: trriplejay/simpleserver
    image_tag: latest
  ci:
    - echo "$USER"
    - echo "$HOME"
    - sudo docker ps -a
    - EXEC_ID=`sudo docker ps | grep shippable-exec | awk '{print $1}'`
    - sudo docker logs --tail=500 $EXEC_ID
    - sudo docker inspect $EXEC_ID
    #- source ~/.nvm/nvm.sh && nvm install 0.12
    - node --version
    - sudo npm install -g grunt-cli
    - RETRY_CMD='npm install 1> /dev/null'
    - shippable_retry $RETRY_CMD
    - ./catFile.sh 1> /dev/null
    #- cat Ulysses.txt 1>&2
    #- cat Ulysses.txt
    - grunt

  on_success:
    - ./node_modules/.bin/istanbul cover grunt -- -u tdd
    - ./node_modules/.bin/istanbul report cobertura --dir  shippable/codecoverage/
